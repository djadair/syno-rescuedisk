#!/bin//bash

if [ ! "$1" = "install" ] ; then
   echo "syntax: sudo $0 install"
   echo
   echo "This script will install all of the packages required"
   echo "to run the usbrootfs generation."
   echo
   echo "It has been most recently tested on bionic [ 18.04 ] but"
   echo "should still work on xenial [ 16.04 ] as well."
   echo
   echo "A slightly modified version of multistrap is required too"
   echo "you can run the version in this directory or if you are ok"
   echo "with unsigned packages install the deb in the fake-dist repo"
   echo
   echo "Note: fake-dist only works because multistrap is NOT included"
   echo "in the target.  If you add it you will have to use --no-auth"
   echo "or add noauth=true to the config."
   echo
   exit 0
fi

if [ !  "$(id -u)" = "0" ]; then
    echo "This script must be run as root, use:"
    echo "sudo $0 install"
    exit 1
fi


# For image creation mandatory
apt install multistrap gparted debconf-utils
apt install btrfs-tools
apt install ecryptfs-utils

# For image creation highly useful
apt install lsscsi
apt install scsitools net-tools

# For dpkg creation ( also requires disabling apparmor on /usr/bin/man )
apt install dpkg-dev debhelper intltool po4a apparmor-utils

# Source access
apt install git

#
# The following are largely personal preferences.  If you don't
# like them or your system does not have equivalents you
# can skip these packages.
#
if [ -n "$2" -a x"$2" = x"full" ] ; then
    
    # to reach source repo.
    apt install ssh nfs-common

    # Utility stuff ( not part of image gen )
    apt install kexec-tools
    apt install emacs vim

    # For VMWare resizable desktop
    apt install open-vm-tools

    # To get VNC to work use xrdp and swap to mate desktop.
    # Note:  clipboard requires vncconfig.
    # Note:  Start session with xrdp then update password and log in
    #        using a vnc client and run vncconfig to get clipboard.
    apt install xrdp vnc4server
    apt install mate-core mate-desktop-environment mate-notification-daemon
    apt install gnome-icon-theme

    echo "mate-session" > ~/.xsession

fi
